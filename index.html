<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZenGrid Hitori - Developed by Bikram</title>
  <style>
    /* --- STYLES UNCHANGED FROM YOUR VERSION --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    /* ... (all your CSS rules unchanged) ... */
  </style>
</head>
<body>
  <!-- Zen floating elements -->
  <div class="zen-element">🕸️</div>
  <div class="zen-element">🌸</div>
  <div class="zen-element">🍃</div>

  <div class="container">
    <div class="paused-overlay">
      <div>
        <div>⏸️ GAME PAUSED</div>
        <div style="font-size: 1rem; margin-top: 1rem;">Click Resume to continue</div>
        <button class="resume-btn" onclick="togglePause()">▶️ Resume Game</button>
      </div>
    </div>

    <div class="content">
      <!-- Loading Screen -->
      <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <h2>Loading ZenGrid Hitori...</h2>
        <p>Preparing your zen puzzle experience</p>
      </div>

      <!-- Title Screen -->
      <div class="title-screen" id="titleScreen" style="display: none;">
        <h1>ZenGrid Hitori</h1>
        <div class="developer-credit">Developed by Bikram</div>
        <button class="menu-btn" onclick="showMenu()">Enter Game</button>
      </div>

      <!-- Main Menu -->
      <div class="menu" id="mainMenu">
        <h2 style="color: #667eea; margin-bottom: 1rem;">Main Menu</h2>
        <button class="menu-btn" onclick="startGame()">🎯 Start Game</button>
        <button class="menu-btn" onclick="showHowToPlay()">📚 How to Play</button>
        <button class="menu-btn" onclick="showAboutGame()">🎌 About Hitori</button>
        <button class="menu-btn" onclick="showStatistics()">📊 Statistics</button>
      </div>

      <!-- Game Screen -->
      <div class="game-screen" id="gameScreen">
        <div class="game-header">
          <div class="game-info">
            <div class="timer" id="timer">00:00</div>
            <div class="hints-left" id="hintsLeft">Hints: 3</div>
          </div>
          <div class="game-controls">
            <button class="control-btn" onclick="togglePause()" id="pauseBtn">⏸️ Pause</button>
            <button class="control-btn" onclick="getHint()">💡 Hint</button>
            <button class="control-btn" onclick="restartGame()">🔄 Restart</button>
            <button class="control-btn" onclick="showMenu()">🏠 Menu</button>
          </div>
        </div>
        <div class="grid" id="gameGrid"></div>
        <button class="submit-btn" onclick="submitSolution()">✅ Submit Solution</button>
      </div>

      <!-- Feedback Modal -->
      <div class="feedback-modal" id="feedbackModal">
        <div class="feedback-content">
          <h3 id="feedbackTitle">Game Status</h3>
          <div id="feedbackMessage"></div>
          <div id="errorsList" class="error-list" style="display: none;"></div>
          <div style="margin-top: 1rem;">
            <button class="menu-btn" onclick="closeFeedback()" style="margin: 0.5rem;">OK</button>
            <button class="menu-btn" onclick="nextGameFromModal()" style="margin: 0.5rem; background: linear-gradient(135deg, #4caf50, #45a049);" id="nextBtn">▶️ Next</button>
          </div>
        </div>
      </div>

      <!-- How to Play -->
      <div class="how-to-play" id="howToPlayScreen">
        <h2>How to Play Hitori</h2>
        <div class="rule"><h3>🎯 Objective</h3><p>Shade some cells so that no number appears more than once in any row or column.</p></div>
        <div class="rule"><h3>📋 Rules</h3><p><strong>1.</strong> Click cells to shade them black</p><p><strong>2.</strong> No two shaded cells can be adjacent (horizontally or vertically)</p><p><strong>3.</strong> All unshaded cells must remain connected</p><p><strong>4.</strong> Each row and column can have each number only once (in unshaded cells)</p></div>
        <div class="rule"><h3>💡 Tips</h3><p>• Start with numbers that appear most frequently</p><p>• Use the hint system when stuck (3 hints per game)</p><p>• Think ahead - shading cells affects connectivity</p><p>• Use the Submit button to check your progress</p></div>
        <button class="back-btn" onclick="showMenu()">Back to Menu</button>
      </div>

      <!-- About -->
      <div class="about-game" id="aboutGameScreen">
        <h2>About Hitori</h2>
        <div class="about-section"><h3>🎌 What is Hitori?</h3><p>Hitori (ひとり) is a Japanese logic puzzle...</p></div>
        <div class="about-section"><h3>📚 History</h3><p>Hitori was created by Nikoli...</p></div>
        <div class="about-section"><h3>🧘 The Zen Philosophy</h3><p>Like many Japanese puzzles, Hitori embodies...</p></div>
        <button class="back-btn" onclick="showMenu()">Back to Menu</button>
      </div>

      <!-- Statistics -->
      <div class="statistics" id="statisticsScreen">
        <h2>Statistics</h2>
        <div class="stat-item"><span>Best Time</span><span id="bestTime">--:--</span></div>
        <div class="stat-item"><span>Games Completed</span><span id="gamesCompleted">0</span></div>
        <div class="stat-item"><span>Average Time</span><span id="averageTime">--:--</span></div>
        <button class="back-btn" onclick="showMenu()">Back to Menu</button>
      </div>

      <!-- Victory -->
      <div class="victory-screen" id="victoryScreen">
        <h2>🎉 Congratulations!</h2>
        <div class="time-display" id="completionTime">Time: 00:00</div>
        <p id="bestTimeMessage"></p>
        <div style="margin-top: 2rem;">
          <button class="menu-btn" onclick="nextGame()" style="margin: 0.5rem;">▶️ Next Game</button>
          <button class="menu-btn" onclick="showMenu()" style="margin: 0.5rem;">🏠 Main Menu</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sounds -->
  <audio id="victorySound" preload="auto">
    <source src="data:audio/wav;base64,UklGRvIGAABXQVZFZm10..." type="audio/wav">
  </audio>

  <script>
    class HitoriGame {
      constructor() {
        this.grid = [];
        this.solution = [];
        this.currentGrid = [];
        this.gridSize = 8;
        this.startTime = null;
        this.elapsedTime = 0;
        this.timerInterval = null;
        this.isPaused = false;
        this.hintsUsed = 0;
        this.maxHints = 3;
        this.loadStatistics();
      }

      /* --- PUZZLE GENERATION (unchanged) --- */

      /* --- NEW checkSolution() MOVED INTO CLASS --- */
      checkSolution() {
        const errors = [];

        // Match correct pattern
        for (let row = 0; row < this.gridSize; row++) {
          for (let col = 0; col < this.gridSize; col++) {
            if (this.solution[row][col] && !this.currentGrid[row][col]) {
              errors.push(`Cell at row ${row+1}, col ${col+1} should be shaded`);
            } else if (!this.solution[row][col] && this.currentGrid[row][col]) {
              errors.push(`Cell at row ${row+1}, col ${col+1} should NOT be shaded`);
            }
          }
        }

        // Adjacent shaded errors
        const adjacentErrors = new Set();
        for (let row = 0; row < this.gridSize; row++) {
          for (let col = 0; col < this.gridSize; col++) {
            if (this.currentGrid[row][col]) {
              const adjacent = [[row-1,col],[row+1,col],[row,col-1],[row,col+1]];
              for (const [r,c] of adjacent) {
                if (r>=0 && r<this.gridSize && c>=0 && c<this.gridSize && this.currentGrid[r][c]) {
                  const key = `${Math.min(row,r)},${Math.min(col,c)}-${Math.max(row,r)},${Math.max(col,c)}`;
                  if (!adjacentErrors.has(key)) {
                    adjacentErrors.add(key);
                    errors.push(`Adjacent shaded cells at (${row+1},${col+1}) and (${r+1},${c+1})`);
                  }
                }
              }
            }
          }
        }
        return errors;
      }

      /* --- rest of class unchanged except STORAGE FIX --- */

      handleVictory() {
        this.stopTimer();
        document.getElementById('victorySound').play().catch(()=>{});
        if (navigator.vibrate) navigator.vibrate([200,100,200]);
        this.updateStatistics();
        document.getElementById('gameScreen').style.display='none';
        document.getElementById('victoryScreen').style.display='block';
        document.getElementById('completionTime').textContent=`Time: ${this.formatTime(this.elapsedTime)}`;

        const bestTime = localStorage.getItem('hitoriBestTime');
        if (!bestTime || this.elapsedTime < parseInt(bestTime)) {
          localStorage.setItem('hitoriBestTime', this.elapsedTime.toString());
          document.getElementById('bestTimeMessage').textContent='🎉 New Best Time!';
        } else {
          document.getElementById('bestTimeMessage').textContent=`Best: ${this.formatTime(parseInt(bestTime))}`;
        }
      }

      updateStatistics() {
        let gamesCompleted = parseInt(localStorage.getItem('hitoriGamesCompleted')||'0')+1;
        let totalTime = parseInt(localStorage.getItem('hitoriTotalTime')||'0')+this.elapsedTime;
        localStorage.setItem('hitoriGamesCompleted',gamesCompleted.toString());
        localStorage.setItem('hitoriTotalTime',totalTime.toString());
      }

      loadStatistics() {
        const bestTime = localStorage.getItem('hitoriBestTime');
        const gamesCompleted = parseInt(localStorage.getItem('hitoriGamesCompleted')||'0');
        const totalTime = parseInt(localStorage.getItem('hitoriTotalTime')||'0');
        document.getElementById('bestTime').textContent = bestTime ? this.formatTime(parseInt(bestTime)) : '--:--';
        document.getElementById('gamesCompleted').textContent = gamesCompleted;
        document.getElementById('averageTime').textContent = gamesCompleted>0 ? this.formatTime(Math.floor(totalTime/gamesCompleted)) : '--:--';
      }
    }

    /* --- GLOBAL FUNCTIONS (unchanged) --- */
    let game;
    window.addEventListener('DOMContentLoaded',()=>{ setTimeout(()=>{document.getElementById('loadingScreen').style.display='none'; document.getElementById('titleScreen').style.display='block';},3000); });
    function showMenu(){ document.querySelectorAll('.container > .content > div').forEach(d=>d.style.display='none'); document.getElementById('mainMenu').style.display='flex'; if(game) game.stopTimer();}
    function startGame(){ document.getElementById('mainMenu').style.display='none'; document.getElementById('gameScreen').style.display='block'; game=new HitoriGame(); game.generatePuzzle(); game.startTimer(); }
    function nextGameFromModal(){ document.getElementById('feedbackModal').style.display='none'; game=new HitoriGame(); game.generatePuzzle(); game.startTimer(); }
    function nextGame(){ document.getElementById('victoryScreen').style.display='none'; document.getElementById('gameScreen').style.display='block'; game=new HitoriGame(); game.generatePuzzle(); game.startTimer(); }
    function showHowToPlay(){ document.getElementById('mainMenu').style.display='none'; document.getElementById('howToPlayScreen').style.display='block'; }
    function showAboutGame(){ document.getElementById('mainMenu').style.display='none'; document.getElementById('aboutGameScreen').style.display='block'; }
    function showStatistics(){ document.getElementById('mainMenu').style.display='none'; document.getElementById('statisticsScreen').style.display='block'; if(game) game.loadStatistics();}
    function restartGame(){ if(game) game.restart(); }
    function getHint(){ if(game) game.getHint(); }
    function togglePause(){ if(game) game.togglePause(); }
    function submitSolution(){ if(game) game.submitSolution(); }
    function closeFeedback(){ if(game) game.closeFeedback(); }
  </script>
</body>
</html>
